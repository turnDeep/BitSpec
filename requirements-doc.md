# BitSpec-GCN 要件定義書
## 化学構造からのマススペクトル予測システム

### 1. プロジェクト概要

#### 1.1 背景
- **課題**: EI-MSスペクトルの予測は、化合物同定や構造解析において重要な技術である
- **現状の問題**: 既存のディープラーニングモデルは計算資源を大量に消費し、推論速度が遅い
- **機会**: BitNet技術による量子化と、GCNによる分子グラフ表現の組み合わせにより、軽量かつ高精度な予測モデルの実現が可能

#### 1.2 目的
化学構造（MOLファイル）からEIマススペクトルを高速かつ高精度に予測する、量子化ニューラルネットワークモデルの開発

#### 1.3 スコープ
- **対象データ**: NIST17.MSPファイルとmol_filesディレクトリ内のMOLファイル
- **予測対象**: m/z値と相対強度からなるEI-MSスペクトル
- **技術範囲**: GCN、BitNet量子化、重み付きコサイン類似度

### 2. ステークホルダー

#### 2.1 主要ステークホルダー
- **開発チーム**: モデル開発、実装、テスト担当
- **研究者**: 化学・創薬研究でのモデル利用
- **エンドユーザー**: 質量分析データ解析者、化学者
- **システム管理者**: モデルのデプロイメント・保守担当

#### 2.2 期待される利益
- 計算資源の削減（メモリ使用量を最大32分の1に削減）
- 推論速度の向上（2-3倍の高速化）
- エッジデバイスでの実行可能性

### 3. 機能要件

#### 3.1 入力処理機能
- **FR-001**: MOLファイルから分子グラフを構築
- **FR-002**: 原子特徴量の抽出（原子番号、結合タイプ、電荷等）
- **FR-003**: 結合情報から隣接行列の生成
- **FR-004**: バッチ処理による複数分子の同時処理

#### 3.2 モデル機能
- **FR-005**: GCNによる分子特徴の階層的学習
- **FR-006**: BitNet量子化による重みの1.58ビット表現
- **FR-007**: マススペクトルのm/z値と強度の予測
- **FR-008**: 重み付きコサイン類似度による学習最適化

#### 3.3 出力機能
- **FR-009**: 予測マススペクトルの生成（m/z: 1-1000範囲）
- **FR-010**: スペクトルの可視化機能
- **FR-011**: NIST形式でのスペクトル出力
- **FR-012**: 信頼度スコアの提供

#### 3.4 評価機能
- **FR-013**: 実測スペクトルとの類似度計算
- **FR-014**: トップNピークの一致率評価
- **FR-015**: 交差検証による性能評価

### 4. 非機能要件

#### 4.1 性能要件
- **NFR-001**: 単一分子の予測時間: 50ms以下
- **NFR-002**: バッチサイズ100での処理: 1秒以内
- **NFR-003**: モデルサイズ: 50MB以下（量子化後）
- **NFR-004**: メモリ使用量: 1GB以下

#### 4.2 精度要件
- **NFR-005**: 重み付きコサイン類似度: 平均0.85以上
- **NFR-006**: トップ10ピークの再現率: 80%以上
- **NFR-007**: m/z値の予測誤差: ±1 Da以内

#### 4.3 可用性要件
- **NFR-008**: CPU環境での動作保証
- **NFR-009**: GPU使用時の3倍高速化
- **NFR-010**: エッジデバイス（Raspberry Pi 4）での動作

#### 4.4 保守性要件
- **NFR-011**: モジュラー設計による拡張性
- **NFR-012**: 詳細なログ出力機能
- **NFR-013**: モデルのバージョン管理

### 5. 制約条件

#### 5.1 技術的制約
- Python 3.8以上の使用
- PyTorchフレームワークベース
- 量子化は1.58ビット（三値: -1, 0, 1）に制限

#### 5.2 データ制約
- 入力はMOLファイル形式に限定
- 予測範囲はm/z 1-1000
- 訓練データはNIST17.MSPの化合物に限定

#### 5.3 リソース制約
- 開発期間: 6ヶ月
- 開発チーム: 3-5名
- 計算リソース: GPU 2枚（訓練用）

### 6. 前提条件

- MOLファイルが標準形式で提供される
- NIST17.MSPデータの品質が保証されている
- PyTorchとRDKitライブラリが利用可能

### 7. リスクと対策

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| 量子化による精度低下 | 高 | 中 | 段階的量子化と精度モニタリング |
| GCNの過学習 | 中 | 高 | ドロップアウト、正則化の実装 |
| データ不均衡 | 中 | 中 | データ拡張、重み付きサンプリング |
| 計算資源不足 | 低 | 低 | クラウドリソースの活用 |

### 8. 成功基準

- 予測精度（重み付きコサイン類似度）が0.85を超える
- モデルサイズが従来手法の1/10以下
- 推論速度が既存手法の2倍以上
- エッジデバイスでの実行可能

### 9. マイルストーン

| フェーズ | 期間 | 成果物 |
|---------|------|---------|
| 要件定義 | 2週間 | 本文書 |
| 設計 | 3週間 | 設計書、仕様書 |
| 実装（基本機能） | 8週間 | プロトタイプ |
| 量子化実装 | 4週間 | 量子化モデル |
| 評価・最適化 | 6週間 | 最終モデル |
| ドキュメント作成 | 3週間 | 利用ガイド |

### 10. 用語定義

| 用語 | 定義 |
|------|------|
| GCN | Graph Convolutional Network - グラフ構造データを処理するニューラルネットワーク |
| BitNet | 1ビット量子化を用いた軽量ニューラルネットワークアーキテクチャ |
| EI-MS | Electron Ionization Mass Spectrometry - 電子イオン化質量分析法 |
| MOLファイル | 分子構造を記述する標準ファイル形式 |
| 重み付きコサイン類似度 | m/z値と強度に重みを適用したスペクトル類似度指標 |